.. image:: ./architecture/image1.png
   :width: 3.35079in
   :height: 0.78559in

ITA_システム構成/環境構築ガイド

基本編

－第1.10版－

Copyright © NEC Corporation 2021. All rights reserved.

免責事項

本書の内容はすべて日本電気株式会社が所有する著作権に保護されています。

本書の内容の一部または全部を無断で転載および複写することは禁止されています。

本書の内容は将来予告なしに変更することがあります。

日本電気株式会社は、本書の技術的もしくは編集上の間違い、欠落について、一切責任を負いません。

日本電気株式会社は、本書の内容に関し、その正確性、有用性、確実性その他いかなる保証もいたしません。

商標

-  LinuxはLinus
      Torvalds氏の米国およびその他の国における登録商標または商標です。

-  Red Hatは、Red Hat,
      Inc.の米国およびその他の国における登録商標または商標です。

-  Apache、Apache Tomcat、Tomcatは、Apache Software
      Foundationの登録商標または商標です。

-  Oracle、MySQLは、Oracle Corporation
      およびその子会社、関連会社の米国およびその他の国における登録商標です。

-  MariaDBは、MariaDB Foundationの登録商標または商標です。

その他、本書に記載のシステム名、会社名、製品名は、各社の登録商標もしくは商標です。

なお、® マーク、TMマークは本書に明記しておりません。

※本書では「Exastro IT Automation」を「ITA」として記載します。

**目次**

`はじめに <#はじめに>`__ `3 <#はじめに>`__

`1 システム要件 <#システム要件>`__ `4 <#システム要件>`__

`1.1 サーバ動作要件 <#_Toc78283650>`__ `4 <#_Toc78283650>`__

`1.2 クライアント動作要件 <#クライアント動作要件>`__
`6 <#クライアント動作要件>`__

`2 システム構成 <#システム構成>`__ `7 <#システム構成>`__

`2.1 システム構成パターン <#システム構成-1>`__ `7 <#システム構成-1>`__

`2.2 システムの通信要件 <#システムの通信要件>`__
`9 <#システムの通信要件>`__

`2.3 サーバ拡張性の影響ポイント <#サーバ拡張性の影響ポイント>`__
`10 <#サーバ拡張性の影響ポイント>`__

はじめに
========

本書では、ITAシステム運用の為のシステム構成と環境構築について説明します。

システム要件
============

1. 

2. 

3. 

4. 

サーバ動作要件
--------------

本システムはLinuxサーバで稼働し、クライアントPCからブラウザ経由でアクセスします。

システムインストールするにあたっては、次の要件を満たしているサーバをご用意ください。

■1.1.1　サーバ構成

   表 1.1.1 サーバ構成一覧

+-------------+-----------+----------------+--------------------------+
| *           | **必須    | **製品名**     | **バージョン**           |
| *カテゴリ** | ／選択**  |                |                          |
+=============+===========+================+==========================+
| OS          | いずれか  | RHEL ※1        | 7.x                      |
|             |           |                |                          |
|             |           |                | 8.x                      |
+-------------+-----------+----------------+--------------------------+
|             |           | CentOS         | 7.x                      |
|             |           |                |                          |
|             |           |                | ※8.xは2021/12/3          |
|             |           |                | 1にEOLとなったため対象外 |
+-------------+-----------+----------------+--------------------------+
|             |           | CentOS Stream  | 8.x                      |
+-------------+-----------+----------------+--------------------------+
| Webサーバ   | 必須      | Apache         | 2.4系                    |
+-------------+-----------+----------------+--------------------------+
| デ          | 必須      | MariaDB        | 10.3以上                 |
| ータベース  |           |                |                          |
+-------------+-----------+----------------+--------------------------+
| 言語        | 必須      | PHP            | ITAv1.9.1以前：7.2       |
|             |           |                |                          |
|             |           |                | ITAv                     |
|             |           |                | 1.10.0以降：7.2または7.4 |
+-------------+-----------+----------------+--------------------------+
| PH          | す        | PhpSpreadsheet | 1.10.1以上               |
| Pライブラリ | べて必須  |                |                          |
+-------------+-----------+----------------+--------------------------+
|             |           | php-yaml       | 2.1.0以上                |
+-------------+-----------+----------------+--------------------------+
| Pea         | 必須      | HTML_AJAX      | 0.5.7以上                |
| rライブラリ |           |                |                          |
+-------------+-----------+----------------+--------------------------+

..

   ※1 Red Hat Enterprise Linux

■1.1.2　サーバ最小スペック

   表 1.1.2 サーバ最小スペック一覧

+-------------+---------------+---------------------------------------+
| カテゴリ    | 最            | 備考                                  |
|             | 小スペック値  |                                       |
+=============+===============+=======================================+
| CPU         | 2Core         |                                       |
+-------------+---------------+---------------------------------------+
| メモリ      | 4GB           |                                       |
+-------------+---------------+---------------------------------------+
| デ          | 1GB           | ITAシステ                             |
| ィスク容量  |               | ムの容量。OSやログ保存の容量を除く。  |
+-------------+---------------+---------------------------------------+

■1.1.3　サイジング

サーバスペックについて、下記三つの観点を目安に設計を行ってください。

#. 1メニューあたりのレコード数

メニュー作成で設定する、ひとつのメニュー内のレコードの数です。

表 1.1.3-1 1メニューあたりの項目数とサーバスペック一覧

+------------------------+--------------------+------------------------+
| メニュー項目数         | CPU                | メモリ                 |
+========================+====================+========================+
| ～ 10,000              | 2Core              | 4GB                    |
+------------------------+--------------------+------------------------+
| 10,000 ～ 20,000       | 4Core              | 8GB                    |
+------------------------+--------------------+------------------------+

2. Ansible作業実行の同時実行数

Ansibleの作業実行を並列処理で実行する数です。

並列実行数は「Ansible共通」＞「インターフェース情報」＞「並列実行数」で設定することができます。

表 1.1.3-2 Ansible作業実行の同時実行数とサーバスペック一覧

+------------------------+--------------------+------------------------+
| 作業実行の同時実行数   | CPU                | メモリ                 |
+========================+====================+========================+
| ～ 50                  | 2Core              | 4GB                    |
+------------------------+--------------------+------------------------+
| 50 ～ 100              | 4Core              | 8GB                    |
+------------------------+--------------------+------------------------+

3. 同時ログイン操作数

同時にログインして操作するユーザー数です。

ログインした状態で画面遷移やフィルタ検索、登録などの操作を行います。

表 1.1.3-3 同時ログイン操作数とサーバスペック一覧

+------------------------+--------------------+------------------------+
| 同時ログイン操作数     | CPU                | メモリ                 |
+========================+====================+========================+
| ～ 200                 | 2Core              | 4GB                    |
+------------------------+--------------------+------------------------+
| 200 ～ 300             | 4Core              | 8GB                    |
+------------------------+--------------------+------------------------+

..

   ITAインストール後の設定は、ITAシステムサーバ※1
   の最小スペック（CPU：2コア／メモリ：4GB）にて動作するように設計されています。

   最小スペック以上で設計する場合は、性能を上げるために設定値のチューニングも実施してください。

   設定値についてはマニュアルの「【参考】インストール時の各コンフィグ設定値」をご参照ください。

   ※1 ITAシステムサーバ …
   Ansibleサーバなど連携ドライバのサーバを別構成にしたITA基本構成

クライアント動作要件
--------------------

本システムの機能を利用するにあたって、クライアント側PCの動作環境は以下を推奨します。

   表 1.2.2 クライアント側PCの動作要件

+--------------+-------------------------+----------------------------+
| **カテゴリ** | **製品名**              | **バージョン**             |
+--------------+-------------------------+----------------------------+
| ソフトウェア | Excel ※1                | MS Office 2010 以上        |
+--------------+-------------------------+----------------------------+
| ブラウザ     | Google Chrome           | 72以上                     |
+--------------+-------------------------+----------------------------+
|              | FireFox                 | 41以上                     |
+--------------+-------------------------+----------------------------+
|              | Edge                    | 20以上                     |
+--------------+-------------------------+----------------------------+

..

   ※1
   Excelファイルダウンロードを行う場合に必須です（ダウンロードファイル形式がExcelのため）。

システム構成
============

.. _システム構成-1:

システム構成
------------

   本ソフトウェアのWeb/AP機能、BackYard機能、データベース、データストレージは、次のようなサーバ構成で運用が可能です。

   表 2.1　システム構成パターン

+---+---------------+--------------------------+----------------------+
| N | 構成          | 説明                     | 備考                 |
| o |               |                          |                      |
+===+===============+==========================+======================+
| 1 | オール        | シ                       | ITA-BASE機           |
|   | インワン構成  | ステムを一つのサーバ上で | 能とオールインワン構 |
|   |               | 組み立てる構成パターン。 | 成可能な連携ドライバ |
|   |               |                          |                      |
|   |               |                          | ・Ansibler-driver    |
|   |               |                          |                      |
|   |               |                          | ・Cobbler-driver     |
+---+---------------+--------------------------+----------------------+
| 2 | HA構成        | システムを全て個別のサー | Web/APサーバ         |
|   |               | バに切り離して冗長構成を | (Act/Act構成)        |
|   |               | とり、データファイル、DB |                      |
|   |               | ファイルを外部ストレージ | DBMSサーバ           |
|   |               | に格納する構築パターン。 | (Act/Sby構成)        |
|   |               |                          |                      |
|   |               |                          | Backyardサーバ       |
|   |               |                          | (Act/Sby構成)        |
+---+---------------+--------------------------+----------------------+

以降に、代表例としてAnsible Driverおよび Ansible
Coreを利用するシステムのイメージ図を記載します。

各利用Driverのシステム構成の詳細については、各システム構成／環境構築ガイドを参照ください。

.. image:: ./architecture/image2.png
   :alt: ダイアグラム 自動的に生成された説明
   :width: 6.69236in
   :height: 3.82153in

.. image:: ./architecture/image3.png
   :alt: ダイアグラム 自動的に生成された説明
   :width: 6.69236in
   :height: 3.72431in

システムの通信要件
------------------

本システム構成において、各サービス間の通信要件は以下の通りです。

| Ansible Driverおよび Terraform
  Driverで利用する通信要件は以下を参照ください。
| ・「システム構成／環境構築ガイド_Ansible-driver 編」

・「システム構成／環境構築ガイド_Terraform-driver 編」

   表 2.2通信要件一覧

+-----+-------+------------+--------------+--------------------------+
| *   | **F   | **TO**     | **           | **主な用途**             |
| *通 | ROM** |            | プロトコル** |                          |
| 信  |       |            |              |                          |
| 番  |       |            | *            |                          |
| 号※ |       |            | *[ポート番号 |                          |
| 1** |       |            | ※2]**        |                          |
+=====+=======+============+==============+==========================+
| ①   | 端末  | We         | http(s)      | Exastro                  |
|     |       | b/APサーバ |              | ITAのW                   |
|     |       |            | [            | ebコンテンツへのアクセス |
|     |       |            | 80(443)/tcp] |                          |
+-----+-------+------------+--------------+--------------------------+
| ②-1 | W     | スト       | ファ         | Webのセッション          |
|     | eb/AP | レージ機器 | イルアクセス | ファイルを格納/参照する  |
|     |       |            |              |                          |
|     | サ    | (          | (tcp or      |                          |
|     | ーバ  | セッション | ス           |                          |
|     |       | ファイル)  | トレージI/O) |                          |
+-----+-------+------------+--------------+--------------------------+
| ②-2 |       | スト       |              | アップロードファイル(Pl  |
|     |       | レージ機器 |              | aybook等)を格納/参照する |
|     |       |            |              |                          |
|     |       | (ア        |              |                          |
|     |       | ップロード |              |                          |
|     |       | ファイル)  |              |                          |
+-----+-------+------------+--------------+--------------------------+
| ②-3 |       | スト       |              | Symphony                 |
|     |       | レージ機器 |              | 実行に実行情報(Playbook, |
|     |       |            |              | host_vars等)を格納する。 |
|     |       | (デー      |              |                          |
|     |       | タリレイス |              |                          |
|     |       | トレージ)  |              |                          |
+-----+-------+------------+--------------+--------------------------+
| ②-4 |       | スト       |              | 一時                     |
|     |       | レージ機器 |              | ファイル(アップロードフ  |
|     |       |            |              | ァイル等)を格納/参照する |
|     |       | (一時      |              |                          |
|     |       | ファイル)  |              |                          |
+-----+-------+------------+--------------+--------------------------+
| ③   |       | DBMSサーバ | tcp          | DBサーバへのアクセス     |
|     |       |            | (DBアクセス) |                          |
|     |       |            |              | (ITA画面で               |
|     |       |            | [3306/tcp]   | の参照・登録・更新・廃止 |
|     |       |            |              | ・復活に伴うデータ処理)  |
+-----+-------+------------+--------------+--------------------------+
| ④   | D     | スト       | ファ         | DBファイルへの書き込み   |
|     | BMSサ | レージ機器 | イルアクセス |                          |
|     | ーバ  |            |              |                          |
|     |       | (D         | (tcp or      |                          |
|     |       | Bファイル) | ス           |                          |
|     |       |            | トレージI/O) |                          |
+-----+-------+------------+--------------+--------------------------+
| ⑤-1 | Bac   | スト       | ファ         | アップロードファイ       |
|     | kyard | レージ機器 | イルアクセス | ル(Playbook等)を参照する |
|     |       |            |              |                          |
|     | サ    | (ア        | (tcp or      |                          |
|     | ーバ  | ップロード | ス           |                          |
|     |       | ファイル)  | トレージI/O) |                          |
+-----+-------+------------+--------------+--------------------------+
| ⑤-2 |       | スト       |              | Symphony実行             |
|     |       | レージ機器 |              | 時の情報やログを格納する |
|     |       |            |              |                          |
|     |       | (デー      |              |                          |
|     |       | タリレイス |              |                          |
|     |       | トレージ)  |              |                          |
+-----+-------+------------+--------------+--------------------------+
| ⑤-3 |       | スト       |              | 一時                     |
|     |       | レージ機器 |              | ファイル(アップロードフ  |
|     |       |            |              | ァイル等)を格納/参照する |
|     |       | (一時      |              |                          |
|     |       | ファイル)  |              |                          |
+-----+-------+------------+--------------+--------------------------+
| ⑥   |       | DBMSサーバ | tcp          | DBサーバへのア           |
|     |       |            | (DBアクセス) | クセス(参照・更新・削除) |
|     |       |            |              |                          |
|     |       |            | [3306/tcp]   |                          |
+-----+-------+------------+--------------+--------------------------+
| ⑦   | Backy | git        | http(s)      | CI/CD For                |
|     | ardサ |            |              | IaCでgitリポジト         |
|     | ーバ  |            | [            | リと連携し資材情報を取得 |
|     |       |            | 80(443)/tcp] |                          |
+-----+-------+------------+--------------+--------------------------+

..

   ※1「2.1システム構成」の構成イメージに上記番号と紐づく通信番号を記載。

   ※2 ポート番号は標準的なポート番号を記載。

サーバ拡張性の影響ポイント
--------------------------

本システム構成において、サーバ拡張性に影響するポイントと構成の考え方は以下の通りです。

#. CPU/メモリ/ディスクのうち主に何が消費されているか

#. リソースが不足するとどのような影響があるか

#. 対処法

..

   表 2.3 サーバ拡張性の影響ポイント

+-------------+----------+----------+----------+----------+----------+
| 　          | Web/AP   | DBMS     | Backyard | 外部     | Ansible  |
|             |          |          |          |          |          |
|             | サーバ   | サーバ   | サーバ   | ス       | サーバ   |
|             |          |          |          | トレージ |          |
+=============+==========+==========+==========+==========+==========+
|             | ACT/ACT  | ACT/SBY  | ACT/SBY  | -        | ACT/SBY  |
+-------------+----------+----------+----------+----------+----------+
| Web         | ①メモリ  | ①CPU・   | 影響なし | ①        | 影響なし |
| ア          | ②検索    | メモリ(M |          | ディスク |          |
| クセス数の  | ・登録・ | ariaDBの |          | ②DB      |          |
|             | 更新が遅 | 性能仕様 |          | の登録・ |          |
| | 増加      | くなるま | に依存)  |          | 更新、フ |          |
| |           | たは大量 | ②検索    |          | ァイルへ |          |
| (様々な要件 | データを | ・登録・ |          | の書き込 |          |
| を総合して) | 処理する | 更新が遅 |          | みがエラ |          |
|             | 際には、 | くなる(M |          | ーになる |          |
|             | メモリが | ariaDBの |          | ③スケー  |          |
|             | 枯渇して | 性能仕様 |          | ルアップ |          |
|             | webにシ  | に依存)  |          | orスケー |          |
|             | ステムエ | ③スケー  |          | ルアウト |          |
|             | ラーが返 | ルアップ |          |          |          |
|             | 却される |          |          |          |          |
|             | ③スケー  |          |          |          |          |
|             | ルアップ |          |          |          |          |
|             | orスケー |          |          |          |          |
|             | ルアウト |          |          |          |          |
+-------------+----------+----------+----------+----------+----------+
| 同          | 影響なし | ①CPU・   | ①CPU     | ①        | ①CPU・   |
| 時実行する  |          | メモリ(M | ②実      | ディスク | メモリ(A |
| Conduct     |          | ariaDBの | 行完了ま | ②DB      | nsibleの |
| or/Symphony |          | 性能仕様 | でに時間 | の登録・ | 性能仕様 |
| 数の増加    |          | に依存)  | がかかる | 更新、フ | に依存)  |
|             |          | ②検索    | または大 | ァイルへ | ②(A      |
|             |          | ・登録・ | 量データ | の書き込 | nsibleの |
|             |          | 更新が遅 | を処理す | みがエラ | 性能仕様 |
|             |          | くなる(M | る際にメ | ーになる | に依存)  |
|             |          | ariaDBの | モリが枯 | ③スケー  | ③        |
|             |          | 性能仕様 | 渇すると | ルアップ | スケール |
|             |          | に依存)  | 実行中の | orスケー | アップor |
|             |          | ③スケー  | Conducto | ルアウト | AAC(旧To |
|             |          | ルアップ | r/Sympho |          | wer)導入 |
|             |          |          | nyは異常 |          |          |
|             |          |          | 終了する |          |          |
|             |          |          | ③スケー  |          |          |
|             |          |          | ルアップ |          |          |
+-------------+----------+----------+----------+----------+----------+
| 作業パタ    | 影響なし | ①CPU・   | ①CPU     | ①        | 影響なし |
| ーンの増加  |          | メモリ(M | ・メモリ | ディスク |          |
| (Movement、 |          | ariaDBの | ②        | ②DB      |          |
| Playbook、  |          | 性能仕様 | 実行完了 | の登録・ |          |
| パラ        |          | に依存)  | までに時 | 更新、フ |          |
| メータシー  |          | ②検索    | 間がかか | ァイルへ |          |
| ト等の増加) |          | ・登録・ | るまたは | の書き込 |          |
|             |          | 更新が遅 | 大量デー | みがエラ |          |
|             |          | くなる(M | タを処理 | ーになる |          |
|             |          | ariaDBの | する際に | ③スケー  |          |
|             |          | 性能仕様 | メモリが | ルアップ |          |
|             |          | に依存)  | 枯渇する | orスケー |          |
|             |          | ③スケー  | とログに | ルアウト |          |
|             |          | ルアップ | エラーを |          |          |
|             |          |          | 出力する |          |          |
|             |          |          | ③スケー  |          |          |
|             |          |          | ルアップ |          |          |
+-------------+----------+----------+----------+----------+----------+
| 対象機      | 影響なし | 影響なし | 影響なし | 影響なし | ①CPU・   |
| 器数の増加  |          |          |          |          | メモリ(A |
|             |          |          |          |          | nsibleの |
|             |          |          |          |          | 性能仕様 |
|             |          |          |          |          | に依存)  |
|             |          |          |          |          | ②(A      |
|             |          |          |          |          | nsibleの |
|             |          |          |          |          | 性能仕様 |
|             |          |          |          |          | に依存)  |
|             |          |          |          |          | ③        |
|             |          |          |          |          | スケール |
|             |          |          |          |          | アップor |
|             |          |          |          |          | AAC(旧To |
|             |          |          |          |          | wer)導入 |
+-------------+----------+----------+----------+----------+----------+
