==============
メールアダプタ
==============

| メールアダプタは、メールサーバからのアラートメールを能動的に取得するための仕組みです。
| ディシジョンテーブルに対して、複数のメールサーバと連携することが可能です。

前提条件
========

* 監視アダプタの登録を行う際には、事前にディシジョンテーブルが登録されている必要があります。ディシジョンテーブルの登録方法に関しては、:doc:`../rule_definition/decision_table` を参照してください。
* メールアダプタがインストール済みである必要があります。インストール方法については、:doc:`adapter_install` を参照してください。

新規登録
========

| 上メニューの :menuselection:`システム --> 監視アダプタ` から監視アダプタ画面を開きます。
| 画面上部にある、:guilabel:` 監視先の追加` ボタンを押下します。
| 「Mail Adapter ver1」を選択します。

.. tip::
    | 監視アダプタを追加するために、監視アダプタに対する「更新可能」のアクセス権限が必要です。


.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_08_v1.7.png
   :scale: 80%
   :align: center

   監視アダプタの選択

| メールアダプタの設定項目を入力します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_41.png
   :scale: 35%
   :align: left

   メールアダプタ(ver. 1)設定画面


.. table:: メールアダプタ(ver. 1)設定項目

   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | 設定項目                                       | 説明                                                                              |
   +============================+===================+===================================================================================+
   | 名前                                           | 入力必須項目です。OASEで管理する監視アダプタの名前を設定してください。            |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | プロトコル                                     | メールサーバを接続する際の暗号化プロトコル(SSL/TLS/使用しない)を選択します。      |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | IMAPサーバー                                   | メールサーバ(IMAP)のホスト名もしくはIPアドレスを指定します。                      |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | ポート                                         | メールサーバ(IMAP)のポート番号を指定します。                                      |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | ユーザ名                                       | 利用するメールアカウントのユーザ名を指定します。                                  |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | パスワード                                     | 利用するメールアカウントのユーザに紐づくパスワードを指定します。                  |
   +----------------------------+-------------------+-----------------------------------------------------------------------------------+
   | ディシジョンテーブル名選択                     | 連携するディシジョンテーブルをプルダウンメニューから選択します。                  |
   +---------------+--------------------------------+-----------------------------------------------------------------------------------+
   | 突合情報      | 条件名                         | ディシジョンテーブルの条件名が表示されます。                                      |
   |               +--------------------------------+-----------------------------------------------------------------------------------+
   |               | Mail項目                       | メールのヘッダーの各項目や本文を指定します。(各項目について下記を参照)            |
   +---------------+--------------------------------+-----------------------------------------------------------------------------------+

.. raw:: html

   <div style="clear:both;"></div>

.. csv-table:: Mail項目
   :header: 項目,説明
   :widths: 20, 60

   message_id, メールのメッセージ ID に対して評価を行います。
   envelope_from, エンベロープ From メールアドレスに対して評価を行います。
   envelope_to, エンベロープ To メールアドレスに対して評価を行います。
   header_from, ヘッダー From メールアドレスに対して評価を行います。
   header_to, ヘッダー To メールアドレスに対して評価を行います。
   mailaddr_from, 送信元メールアドレスに対して評価を行います。メール送信元の表示名(Display name)と :program:`header_from` の両方が記載されます。 送信元のメールアドレスを評価する場合は、 :program:`mailaddr_from` を利用することを推奨します。
   mailaddr_to, 送信先のメールアドレスに対して評価を行います。複数のメールアドレスが存在する場合、カンマ区切りの文字列として評価されます。送信先のメールアドレスを評価する場合は、 :program:`mailaddr_to` を利用することを推奨します。
   date, メールの送信(作成)日時に対して *YYYY-MM-DD HH:mm:ss* 形式の文字列として評価を行います。
   subject, メールの件名に対して評価を行います。
   body, メール本文に対して評価を行います。

.. warning:: 
   | :program:`envelope_to` 、:program:`header_to` および :program:`mailaddr_to` のいずれにおいても CC (Carbon Copy) に設定されたメールアドレスは評価されません。


| 各項目の入力が完了したら、:guilabel:` 保存` ボタンを押し設定を保存します。


設定変更
========

| 上メニューの :menuselection:`システム --> 監視アダプタ` から監視アダプタ画面を開き、 :menuselection:`Mail Adapter ver1` タブを押下し、メールアダプタの一覧を表示します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_42.png
   :scale: 60%
   :align: center

   メールアダプタ一覧

| 編集対象の監視アダプタの詳細確認ボタン :guilabel:`` をクリックし、詳細画面を開きます。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_43.png
   :scale: 60%
   :align: center

   メールアダプタ詳細画面

| 画面下部にある :guilabel:` 編集` ボタンから編集画面を開き、該当の項目を編集します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_49.png
   :scale: 60%
   :align: center

   メールアダプタ編集画面

| 各項目の入力が完了したら、:guilabel:` 保存` ボタンを押し設定を保存します。