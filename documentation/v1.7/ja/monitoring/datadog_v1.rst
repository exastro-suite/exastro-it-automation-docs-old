===============
Datadogアダプタ
===============

| Datadog アダプタは、Datadog で提供されているアラート情報(`イベント情報 <https://docs.datadoghq.com/ja/api/latest/events/>`_)を能動的に取得するための仕組みです。
| ディシジョンテーブルに対して、複数の Datadog エンドポイントと連携することが可能です。

前提条件
========

* 監視アダプタの登録を行う際には、事前にディシジョンテーブルが登録されている必要があります。ディシジョンテーブルの登録方法に関しては、:doc:`../rule_definition/decision_table` を参照してください。
* Datadog監視アダプタがインストール済みである必要があります。インストール方法については、:doc:`adapter_install` を参照してください。

新規登録
========

| 上メニューの :menuselection:`システム --> 監視アダプタ` から監視アダプタ画面を開きます。
| 画面上部にある、:guilabel:` 監視先の追加` ボタンを押下します。
| 「Datadog Adapter ver1」を選択します。

.. tip::
    | 監視アダプタを追加するために、監視アダプタに対する「更新可能」のアクセス権限が必要です。


.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_08_v1.6.png
   :scale: 80%
   :align: center

   監視アダプタの選択

| Datadog アダプタの設定項目を入力します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_36.png
   :scale: 35%
   :align: left

   Datadogアダプタ(ver. 1)設定画面


.. table:: Datadogアダプタ(ver. 1)設定項目

   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | 設定項目                                                               | 説明                                                                                                                                                    |
   +============================+===========================================+=========================================================================================================================================================+
   | 名前                                                                   | 入力必須項目です。OASEで管理する監視アダプタの名前を設定してください。                                                                                  |
   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | URI                                                                    | Datadog から取得したいデータの HTTP API の URI を指定します。アラートに関しては、https://api.datadoghq.com/api/v1/events というAPIが提供されています。  |
   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | API KEY                                                                | Datadog HTTP API が利用可能な API キーを指定します。                                                                                                    |
   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | APPLICATION KEY                                                        | Datadog HTTP API が利用可能なアプリケーションキーを指定します。                                                                                         |
   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | プロキシ                                                               | Datadog に接続する際に利用するプロキシサーバを指定します。(任意)                                                                                        |
   +----------------------------+-------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ディシジョンテーブル名選択                                             | 連携するディシジョンテーブルをプルダウンメニューから選択します。                                                                                        |
   +---------------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
   | 突合情報      | 条件名                                                 | `Datadog のアラート <https://docs.datadoghq.com/ja/api/latest/events/>`_ で評価したい項目を選択します。                                                 |
   +---------------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+

.. raw:: html

   <div style="clear:both;"></div>

| 例えば、下記のレスポンスを取得した場合の Datadog の項目の指定方法は、以下のようになります。


.. code-block:: sh

   curl https://api.datadoghq.com/api/v1/events

.. code-block:: json

   {
      "events": [
         {
            "alert_type": "info",
            "date_happened": 46337152,
            "device_name": "cillum",
            "host": "ut pariatur reprehenderit culpa",
            "id": 97756271,
            "id_str": "do cupidatat qui Duis",
            "payload": "{}",
            "priority": "normal",
            "source_type_name": "ex cillum ut",
            "tags": [
            "environment:test"
            ],
            "text": "Oh boy!",
            "title": "Did you hear the news today?",
            "url": "Duis sit"
         }
      ],
      "status": "ullamco aliquip velit pariatur"
   }

.. csv-table:: API 取得結果と項目の指定
   :header: キーの指定方法,評価される値
   :widths: 20, 30

   evnets.[].alert_type,info
   evnets.[].date_happened,46337152
   evnets.[].device_name,cillum
   evnets.[].host,"ut pariatur reprehenderit culpa"
   evnets.[].id,97756271
   evnets.[].id_str,"do cupidatat qui Duis"
   evnets.[].payload,"{}"
   evnets.[].priority,normal
   evnets.[].source_type_name,"ex cillum ut"
   evnets.[].tags.[],"environment:test"
   evnets.[].text,Oh boy!
   evnets.[].title,Did you hear the news today?
   evnets.[].url,Duis sit"
   status,"ullamco aliquip velit pariatur"

| 各項目の入力が完了したら、:guilabel:` 保存` ボタンを押し設定を保存します。


設定変更
========

| 上メニューの :menuselection:`システム --> 監視アダプタ` から監視アダプタ画面を開き、 :menuselection:`Datadog Adapter ver1` タブを押下し、Datadog アダプタの一覧を表示します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_37.png
   :scale: 60%
   :align: center

   Datadog アダプタ一覧

| 編集対象の監視アダプタの詳細確認ボタン :guilabel:`` をクリックし、詳細画面を開きます。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_38.png
   :scale: 60%
   :align: center

   Datadog アダプタ詳細画面

| 画面下部にある :guilabel:` 編集` ボタンから編集画面を開き、該当の項目を編集します。

.. figure:: /images/ja/monitoring_adapter/monitoring_adapter_40.png
   :scale: 60%
   :align: center

   Datadog アダプタ編集画面

| 各項目の入力が完了したら、:guilabel:` 保存` ボタンを押し設定を保存します。