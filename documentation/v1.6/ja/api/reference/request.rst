==================
イベントリクエスト
==================

| ディシジョンテーブルに対して、イベントリクエスト(イベントメッセージを送信)するために必要な情報について説明します。


プロパティ
==========

| API リクエスト時に指定するプロパティは下記のとおりです。

.. table:: イベントリクエストのプロパティ

   +---------------+----------+----------------------------+------------------------------------------------+
   | プロパティ    | データ型 | 説明/設定値                |  設定値説明                                    |
   +===============+==========+============================+================================================+
   | decisiontable | 文字列   | ディシジョンテーブル名                                                      |
   +---------------+----------+---------------+-------------------------------------------------------------+
   | requesttype   | 文字列   | リクエスト種別                                                              |
   +               +          +----------------------------+------------------------------------------------+
   |               |          | * 1                        | リクエスト送信先をプロダクションに選択する。   |
   +               +          +----------------------------+------------------------------------------------+
   |               |          | * 2                        | リクエスト送信先をステージングに選択する。     |
   +---------------+----------+----------------------------+------------------------------------------------+
   | eventdatetime | 文字列   | イベント発生日時                                                            |
   +               +          +----------------------------+------------------------------------------------+
   |               |          | + \- (ハイフン)            | 時刻指定をしません。                           |
   +               +          +----------------------------+------------------------------------------------+
   |               |          | + YYYY/MM/DD HH:mm:ss      | イベント発生時刻を設定します。                 |
   +---------------+----------+----------------------------+------------------------------------------------+
   | eventinfo     | 配列     | イベント情報                                                                |
   +               +          +                                                                             +
   |               |          | ディシジョンテーブルで定義した条件式と項目数が一致する必要があります。      |
   +---------------+----------+-----------------------------------------------------------------------------+


リクエストヘッダ
================

| API リクエスト時に必要となるヘッダー情報は下記のとおりです。

.. table:: リクエストヘッダ

   +---------------+--------------------------------------+--------------------------------------+
   | ヘッダー      |説明/設定値                           | 設定値説明                           |
   +===============+======================================+======================================+
   | Content-Type  | コンテンツ形式                                                              |
   +               +--------------------------------------+--------------------------------------+
   |               | * application/json                   | JSON 形式のみサポートしています。    |
   +---------------+--------------------------------------+--------------------------------------+
   | Authorization | 認証情報                                                                    |
   +               +--------------------------------------+--------------------------------------+
   |               | * Bearer: <token>                    | 払い出し済みのトークンを設定します。 |
   +---------------+--------------------------------------+--------------------------------------+

レスポンス
==========

| API リクエスト時のレスポンスは下記の通りとなります。

+------------+--------------------------------------------------+-------------------------------------------------------------------+
| プロパティ | 説明/返却値                                      | 返却値説明                                                        |
+============+==================================================+===================================================================+
| result     | API の実行結果です。                                                                                                 |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * true                                           | API の実行に成功した場合に出力されます。                          |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * false                                          | API の実行に失敗した場合に出力されます。                          |
+------------+--------------------------------------------------+-------------------------------------------------------------------+
| msg        | API の実行結果に対するメッセージです。                                                                               |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Accept request.                                | リクエストを正常に受け付けました。                                |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Unmatch, Number of event information elements. | イベント情報の要素の数が不一致です。                              |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Invalid request. Must be POST. Not GET.        | 無効なリクエスト。POST である必要があります。GET ではありません。 |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Invalid request format. Must be JSON.          | 無効なリクエスト形式。JSON 形式である必要があります。             |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Invalid request type.                          | 無効なリクエストの種類です。                                      |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Invalid request.                               | 無効なリクエストです。                                            |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * Unexpected error.                              | 予想外のエラーです。                                              |
+            +--------------------------------------------------+-------------------------------------------------------------------+
|            | * other error.                                   | その他エラーです。                                                |
+------------+--------------------------------------------------+-------------------------------------------------------------------+
| trace_id   | イベントシリアルNo. です。取得したイベントメッセージの追跡に利用します。                                             |
+------------+--------------------------------------------------+-------------------------------------------------------------------+

Example
=======

| ディシジョンテーブル *decisiontable001* に対して、リクエストを送信する例は以下のようになります。

リクエスト
----------

.. code-block:: bash

   curl -X POST -k 'https://<fqdn_or_ip_address>/oase_web/event/event/eventsrequest' \
        -H 'accept: application/json' \
        -H 'Authorization: Bearer <access_token>' \
        -d '{
             "decisiontable": "decisiontable001",
             "requesttype":   "1",
             "eventdatetime": "2018/12/13 15:16:29",
             "eventinfo":     ["This is alert message.","hostname"]
            }'

レスポンス
----------

.. code-block:: json

   {"result": true, "msg": "Accept request.", "trace_id": "TOS_20210412053112220048_0000000010"} 

